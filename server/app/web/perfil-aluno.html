<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/aluno/perfilAluno.css">

    <title>eClasses</title>
</head>

<body>
    <header class="bg-primary">
        <div class="container">
            <div class="row">
                <div class="col-11">
                    <h2>eClasses</h2>
                </div>
            </div>
        </div>
    </header>

    <main id="altered-main">
        <div class="container">
            <div class="row">
                <div class="card col-12 col-md-6">
                    <h3 id="nome" class="card-header bg-primary text-white">

                    </h3>
                    <div class="card-body">
                        <dl id="listaDados" class="row">
                            <dt class="col-6">E-mail</dt>
                            <dd class="col-6" id="email"></dd>
                            <dt class="col-6">UF</dt>
                            <dd class="col-6" id="uf"></dd>
                            <dt class="col-6">Município</dt>
                            <dd class="col-6" id="municipio"></dd>
                            <dt class="col-6">Assinante</dt>
                            <dd class="col-6" id="assinante"></dd>
                        </dl>
                    </div>
                    <div class="card-footer">
                        <div class="row">
                            <a id="editarPerfil" data-toggle="modal" href="#modalAluno" class="btn btn-secondary col-12 col-md-3" onclick="">Editar
                                perfil</a>
                            <a data-toggle="modal" href="#modalSenha" class="btn btn-outline-danger ml-auto"
                                onclick="">Alterar senha</a>
                        </div>
                    </div>
                </div>


                <div class="modal fade" id="modalAluno" tabindex="-1" role="dialog" aria-labelledby="modalAluno" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Editar perfil</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">

                        <div class="form-group row">
                            <label for="nome-aluno" class="col-md-3 col-form-label">Nome</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" id="nomeAlt" name="nome-aluno">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="estado" class="col-md-3 col-form-label">UF</label>
                            <div class="col-md-3">
                                <select id="estadoAlt" name="estado" onchange="carregarMunicipio()">
                                </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="municipio" class="col-md-3 col-form-label">Município</label>
                            <div class="col-md-3">
                                <select id="municipioAlt" name="municipio">
                                </select>
                            </div>
                        </div>


                      </div>
                      <div class="modal-footer">

                        <p id="respostaPerfil" class="floatL displayNone"></p>

                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="botaoEditar">Editar</button>

                      </div>
                    </div>
                  </div>
                </div>



                <div class="modal fade" id="modalSenha" tabindex="-1" role="dialog" aria-labelledby="modalSenha" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Alterar senha</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <input type="password" id="senha1" placeholder="Senha atual" class="onlyCenter">
                        <input type="password" id="senha2" placeholder="Nova senha" class="onlyCenter">
                        <input type="password" id="senha3" placeholder="Repita a nova senha" class="onlyCenter">
                      </div>
                      <div class="modal-footer">

                        <p id="respostaSenha" class="floatL displayNone"></p>

                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="botaoAlterar">Alterar</button>

                      </div>
                    </div>
                  </div>
                </div>

                <div class="card col-12 col-md-5 offset-md-1">
                    <h3 class="card-header bg-dark text-white">
                        Preferências
                    </h3>
                    <div class="card-body">
                        <dl id="listaPreferencias" class="row">
                            <dt class="col-6">Preço limite</dt>
                            <dd class="col-6" id="preco">R$ </dd>
                            <dt class="col-6">Localidade</dt>
                            <dd class="col-6" id="local"></dd>
                            <dt class="col-6">Nº máximo de alunos</dt>
                            <dd class="col-6" id="numero-alunos"></dd>
                            <dt class="col-12 center">Materias</dt>
                        </dl>
                    </div>
                    <div class="card-footer">
                        <div class="row">
                            <a data-toggle="modal" href="#modalPreferencias" id="abrirPreferencias" class="btn btn-secondary col-12 col-md-5" onclick="">Editar
                                preferências</a>
                        </div>
                    </div>
                </div>



                <div class="modal fade larger" id="modalPreferencias" tabindex="-1" role="dialog" aria-labelledby="modalPreferencias" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Editar preferencias</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">

                        <div class="form-group row">
                            <label for="precoAlt" class="col-3 col-form-label">Preço limite</label>
                            <div class="col-3">
                                <input step="0.01" min="0" type="number" class="form-control" id="precoAlt" name="precoAlt">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="localidade" class="col-md-3 col-form-label">Localidade</label>
                            <div class="col-md-3">
                                <select id="localidadeAlt" name="localidade">
                                </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="numeroAlunosAlt" class="col-5 col-form-label">Nº máximo de alunos</label>
                            <div class="col-sm-3">
                                <input min="1" type="number" class="form-control" id="numeroAlunosAlt" name="numeroAlunosAlt">
                            </div>
                        </div>

                        <p class="col-12 center afast"><strong>Materias</strong></p>
                        <div class="form-group row">
                            <div class="col-5 centralize">
                              <select id="materiasAlt" name="materias">
                              </select><button id="add">+</button>
                            </div>
                            <div  class="col-7 centralize">
                              <ul id="listarMaterias">
                              </ul>
                            </div>
                        </div>


                      </div>
                      <div class="modal-footer">

                        <p id="respostaPerfil" class="floatL displayNone"></p>

                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="botaoEditar">Editar</button>

                      </div>
                    </div>
                  </div>
                </div>



            </div>

            <div class="row">

            </div>
        </div>
    </main>

    <footer class="bg-secondary fixed-bottom">
        <div class="container">
            <div class="row">
                <div class="col">
                    <b>Desenvolvido por:</b>
                    <p>Matheus Guimarães | Pedro Augusto Gandra | Pedro Henrique Pereira | Samuel Pedro Fernandes |
                        Thiago Lepesqueur | Vitor Fitzherbert</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
      let listaDados = document.querySelector("#listaDados");
      let listaPreferencias = document.querySelector("#listaPreferencias");
      let idAluno;
      let idUf;
      let idMunicipio;
      let idPrefLocal;

      let campoNome = document.querySelector("#nome");
      let campoEmail = document.querySelector("#email");
      let campoUf = document.querySelector("#uf");
      let campoMunicipio = document.querySelector("#municipio");
      let campoAssinante = document.querySelector("#assinante");

      let campoPreco = document.querySelector("#preco");
      let campoLocalidade = document.querySelector("#local");
      let campoNumeroAlunos = document.querySelector("#numero-alunos");
      let listaMaterias = [];
      let listaIDM = [];

      let nomeAlt = document.querySelector("#nomeAlt");
      let selUf = document.querySelector("#estadoAlt");
      let selMunicipio = document.querySelector("#municipioAlt");


      let numeroAlunosAlt = document.querySelector("#numeroAlunosAlt");
      let precoAlt = document.querySelector("#precoAlt");
      let localidadeAlt = document.querySelector("#localidadeAlt");
      let selMateria = document.querySelector("#materiasAlt");
      let exibirMaterias = document.querySelector("#listarMaterias");
      let deletButtons;


      document.querySelector("#botaoAlterar").addEventListener("click", function() { alterarSenha() });
      document.querySelector("#editarPerfil").addEventListener("click", function() {prepararEdicaoPerfil()});
      document.querySelector("#botaoEditar").addEventListener("click", function() {editarPerfil()});
      document.querySelector("#abrirPreferencias").addEventListener("click", abrirPreferencias);
      document.querySelector("#add").addEventListener("click", addMateria);

      function add() {
        deletButtons = document.querySelectorAll(".delet");
        for (let i = 0; i < deletButtons.length; i++) {
          deletButtons[i].addEventListener("click",function(){ removeElement(event); }, false);
        }
      }

      function removeElement(event) {
        console.log(listaIDM);
        let index = listaIDM.indexOf(event.currentTarget.parentNode.id);
        listaIDM.splice(index, 1);
        let removivel = event.currentTarget.parentNode;
        event.currentTarget.parentNode.parentNode.removeChild(removivel);
      }

      function addMateria() {
        if (!listaIDM.includes(selMateria.value)) {
          listaIDM.push(selMateria.value);
          var button = document.createElement("button");
          button.classList.add("delet");
          button.classList.add("btn-outline-danger");
          button.innerHTML = "x";
          var editar = document.createElement("li");
          editar.classList.add("linha");
          editar.appendChild(button);
          editar.innerHTML += selMateria.options[selMateria.selectedIndex].text;
          exibirMaterias.appendChild(editar);
          deletButtons = document.querySelectorAll(".delet");
          add();
        }
      }

      function abrirPreferencias() {
        precoAlt.value = parseFloat(campoPreco.innerHTML.replace("R$ ", ""));
        numeroAlunosAlt.value = campoNumeroAlunos.innerHTML;
        carregarPreferenciaLocal();
        carregarMaterias();
        exibirMaterias.innerHTML = "";
        listaIDM.length = 0;
            setTimeout(function(){
              document.getElementById("id-pref-local-"+idPrefLocal).selected = true;
              for(let i = 0; i < selMateria.options.length; i++) {
                for(let j = 0; j < listaMaterias.length; j++) {
                  if (selMateria.options[i].innerHTML == listaMaterias[j]) {
                    listaIDM.push(selMateria.options[i].value);
                    var button = document.createElement("button");
                    button.classList.add("delet");
                    button.classList.add("btn-outline-danger");
                    button.innerHTML = "x";
                    var editar = document.createElement("li");
                    editar.classList.add("linha");
                    editar.id = selMateria.options[i].value;
                    editar.appendChild(button);
                    editar.innerHTML += listaMaterias[j];
                    exibirMaterias.appendChild(editar);
                    deletButtons = document.querySelector(".delet");
                  }
                }
              }
              add();
            }, 500);
      }





      window.onload = function() {
        consultarLogado();
      };

    </script>
    <script src="js/aluno/editarPerfil.js"></script>
    <script src="js/aluno/consultarLogado.js"></script>
    <script src="js/aluno/alterarSenha.js"></script>
    <script src="js/utils/convertions.js"></script>
    <script src="js/preencherLocais.js"></script>
    <script src="js/carregarLocais.js"></script>
    <script src="lib/jquery/jquery-3.5.1.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>


</body>

</html>
